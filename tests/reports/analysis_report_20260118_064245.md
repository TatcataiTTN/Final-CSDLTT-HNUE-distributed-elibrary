# Test Result Analysis & Debug Solutions

**Generated:** Sun Jan 18 06:42:45 +07 2026
**Report:** /Users/tuannghiat/Downloads/Final CSDLTT/tests/debug/../reports/analysis_report_20260118_064245.md

---

## 1. Environment Analysis

‚úÖ **PHP Installed:** PHP 8.4.14 (cli) (built: Oct 21 2025 19:23:55) (NTS)
‚úÖ **MongoDB Extension:** Version 2.1.4
‚úÖ **Docker:** Docker version 28.5.1, build e180ab8
‚úÖ **Docker Daemon:** Running
‚úÖ **Composer:** Composer version 2.8.12 2025-09-19 13:41:59

## 2. Docker Container Analysis

### Container: mongo1

- **Status:** ‚úÖ running
- **Started:** 2026-01-17T13:40:23.789761299Z
- **MongoDB Version:** 4.4.29
- **Connection:** ‚úÖ Working
### Container: mongo2

- **Status:** ‚úÖ running
- **Started:** 2026-01-17T13:40:23.787977465Z
- **MongoDB Version:** 4.4.29
- **Connection:** ‚úÖ Working
### Container: mongo3

- **Status:** ‚úÖ running
- **Started:** 2026-01-17T13:40:23.895397465Z
- **MongoDB Version:** 4.4.29
- **Connection:** ‚úÖ Working
### Container: mongo4

- **Status:** ‚úÖ running
- **Started:** 2026-01-17T13:40:23.894827799Z
- **MongoDB Version:** 4.4.29
- **Connection:** ‚úÖ Working

## 3. Replica Set Analysis

‚úÖ **Replica Set Status:** Initialized
- **PRIMARY:** mongo2:27017
- **SECONDARY Count:** 2
### Replication Lag

- **mongo3:** 0s lag
- **mongo4:** 0s lag

## 4. PHP Server Analysis

### Port 8001

- **Status:** ‚ùå NOT RUNNING

**Debug Solution:**
```bash
# Check if port is in use
lsof -i :8001

# Start all PHP servers
./start_system.sh

# Or start manually
php -S localhost:8001 -t Nhasach &

# Verify
lsof -i :8001
```
### Port 8002

- **Status:** ‚ùå NOT RUNNING

**Debug Solution:**
```bash
# Check if port is in use
lsof -i :8002

# Start all PHP servers
./start_system.sh

# Or start manually
php -S localhost:8002 -t NhasachHaNoi &

# Verify
lsof -i :8002
```
### Port 8003

- **Status:** ‚ùå NOT RUNNING

**Debug Solution:**
```bash
# Check if port is in use
lsof -i :8003

# Start all PHP servers
./start_system.sh

# Or start manually
php -S localhost:8003 -t NhasachDaNang &

# Verify
lsof -i :8003
```
### Port 8004

- **Status:** ‚ùå NOT RUNNING

**Debug Solution:**
```bash
# Check if port is in use
lsof -i :8004

# Start all PHP servers
./start_system.sh

# Or start manually
php -S localhost:8004 -t NhasachHoChiMinh &

# Verify
lsof -i :8004
```

## 5. Composer Dependencies Analysis

### Branch: Nhasach

- **composer.json:** ‚úÖ Found
- **composer.lock:** ‚úÖ Found
- **Dependencies:** ‚úÖ Installed
- **Outdated Packages:** ‚ö†Ô∏è        1
### Branch: NhasachHaNoi

- **composer.json:** ‚úÖ Found
- **composer.lock:** ‚úÖ Found
- **Dependencies:** ‚úÖ Installed
- **Outdated Packages:** ‚ö†Ô∏è        1
### Branch: NhasachDaNang

- **composer.json:** ‚úÖ Found
- **composer.lock:** ‚úÖ Found
- **Dependencies:** ‚úÖ Installed
- **Outdated Packages:** ‚ö†Ô∏è        1
### Branch: NhasachHoChiMinh

- **composer.json:** ‚úÖ Found
- **composer.lock:** ‚úÖ Found
- **Dependencies:** ‚úÖ Installed
- **Outdated Packages:** ‚ö†Ô∏è        1

## 6. Database Data Analysis

### Central Hub (mongo1)

- **Books:** 0
- **Users:** 0

**Recommendation:**
```bash
# Import books data
docker exec -i mongo1 mongoimport --db Nhasach --collection books --file /data/books.json
```
### Branch Databases

**HaNoi (mongo2):**
- Books: 162
- Users: 13
- Orders: 46

**DaNang (mongo3):**
- Books: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b9147829fbadb7942763d"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0
- Users: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b9147829fbadb7942763d"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0
- Orders: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b9147829fbadb7942763d"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0

**HoChiMinh (mongo4):**
- Books: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b914755e21082648da32b"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0
- Users: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b914755e21082648da32b"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0
- Orders: uncaught exception: Error: command failed: {
	"topologyVersion" : {
		"processId" : ObjectId("696b914755e21082648da32b"),
		"counter" : NumberLong(18)
	},
	"operationTime" : Timestamp(1768693364, 1),
	"ok" : 0,
	"errmsg" : "not master and slaveOk=false",
	"code" : 13435,
	"codeName" : "NotPrimaryNoSecondaryOk",
	"$clusterTime" : {
		"clusterTime" : Timestamp(1768693364, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	}
} : aggregate failed :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
doassert@src/mongo/shell/assert.js:18:14
_assertCommandWorked@src/mongo/shell/assert.js:706:17
assert.commandWorked@src/mongo/shell/assert.js:796:16
DB.prototype._runAggregate@src/mongo/shell/db.js:266:5
DBCollection.prototype.aggregate@src/mongo/shell/collection.js:1058:12
DBCollection.prototype.countDocuments@src/mongo/shell/collection.js:1450:17
@(shell eval):1:1
exiting with code -4
0


## 7. Priority Action Plan

### üî¥ CRITICAL (Must Fix Immediately)

- PHP server not running on port 8001
- PHP server not running on port 8002
- PHP server not running on port 8003
- PHP server not running on port 8004

### üü° MEDIUM (Should Fix)

- Central Hub has no books

### üü¢ LOW (Nice to Fix)

- Nhasach has        1 outdated packages
- NhasachHaNoi has        1 outdated packages
- NhasachDaNang has        1 outdated packages
- NhasachHoChiMinh has        1 outdated packages


## 8. Quick Fix Script

```bash
#!/bin/bash
# Auto-generated quick fix script

# Fix critical issues
./start_system.sh

# Verify fixes
./run_all_tests.sh
```

## 9. Summary

**Total Issues Found:** 9

- üî¥ Critical: 4
- üü† High: 0
- üü° Medium: 1
- üü¢ Low: 4

‚ö†Ô∏è **System Status:** Issues detected - see action plan above

---

**Full Report:** /Users/tuannghiat/Downloads/Final CSDLTT/tests/debug/../reports/analysis_report_20260118_064245.md
